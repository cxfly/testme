<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="testunitFlowCase">
<typeAlias alias="testunitFlowCaseDO"    type="com.alibaba.testme.domain.dataobject.TestunitFlowCaseDO" />
<typeAlias alias="testunitFlowCaseVO"    type="com.alibaba.testme.domain.vo.TestunitFlowCaseVO" />
<typeAlias alias="testCaseVO"    type="com.alibaba.testme.domain.vo.TestCaseVO" />
<typeAlias alias="testunitFlowCaseQuery"    type="com.alibaba.testme.domain.query.TestunitFlowCaseQuery" />

  <resultMap id="testunitFlowCaseDO_resultMap" class="testunitFlowCaseDO">
    <result property="id" column="ID" />
    <result property="gmtCreate" column="GMT_CREATE" />
    <result property="creator" column="CREATOR" />
    <result property="gmtModified" column="GMT_MODIFIED" />
    <result property="modifier" column="MODIFIER" />
    <result property="testunitFlowId" column="TESTUNIT_FLOW_ID" />
    <result property="status" column="STATUS" />
    <result property="gmtStart" column="GMT_START" />
    <result property="gmtEnd" column="GMT_END" />
    <result property="userId" column="USER_ID" />
    <result property="systemId" column="SYSTEM_ID" />
    <result property="systemEnvId" column="SYSTEM_ENV_ID" />
    <result property="gmtNextRetry" column="GMT_NEXT_RETRY" />
  </resultMap>
 

  <sql id="testunitFlowCase.column_List">
		   ID
		  ,GMT_CREATE
		  ,CREATOR
		  ,GMT_MODIFIED
		  ,MODIFIER
		  ,TESTUNIT_FLOW_ID
		  ,STATUS
		  ,GMT_START
		  ,GMT_END
		  ,USER_ID
		  ,SYSTEM_ENV_ID
		  ,SYSTEM_ID
		  ,GMT_NEXT_RETRY 
  </sql>
   
  <sql id="testunitFlowCase.queryCondition">
    <dynamic>
      <isNotEmpty property="id" prepend="AND">
        <![CDATA[  
        ID = #id#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="creator" prepend="AND">
        <![CDATA[  
        CREATOR = #creator#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="modifier" prepend="AND">
        <![CDATA[  
        MODIFIER = #modifier#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="testunitFlowId" prepend="AND">
        <![CDATA[  
        TESTUNIT_FLOW_ID = #testunitFlowId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="status" prepend="AND">
        <![CDATA[  
        STATUS = #status#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="gmtStart" prepend="AND">
        <![CDATA[  
        GMT_START = #gmtStart#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="gmtEnd" prepend="AND">
        <![CDATA[  
        GMT_END = #gmtEnd#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="userId" prepend="AND">
        <![CDATA[  
        USER_ID = #userId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="systemEnvId" prepend="AND">
        <![CDATA[  
        SYSTEM_ENV_ID = #systemEnvId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="systemId" prepend="AND">
        <![CDATA[  
        SYSTEM_ID = #systemId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="gmtNextRetry" prepend="AND">
        <![CDATA[  
        GMT_NEXT_RETRY = #gmtNextRetry#  
        ]]>  
      </isNotEmpty>
    </dynamic>
  </sql>

  
  <insert id="testunitFlowCase.add" parameterClass="testunitFlowCaseDO">
    INSERT INTO tm_testunit_flow_case(
		        GMT_CREATE
			   ,CREATOR 
			   ,GMT_MODIFIED 
			   ,MODIFIER 
			   ,TESTUNIT_FLOW_ID 
			   ,STATUS ,GMT_START 
			   ,GMT_END 
			   ,USER_ID 
			   ,SYSTEM_ENV_ID 
			   ,SYSTEM_ID 
			   ,GMT_NEXT_RETRY) VALUES (
			    now()
			   ,#creator# 
			   ,now()
			   ,#modifier# 
			   ,#testunitFlowId# 
			   ,#status# 
			   ,#gmtStart#
			   ,#gmtEnd# 
			   ,#userId# 
			   ,#systemEnvId#
			   ,#systemId# 
			   ,#gmtNextRetry#)
  
      <selectKey keyProperty="id" resultClass="Long">
		SELECT LAST_INSERT_ID() AS value
      </selectKey>
  </insert>


  <update id="testunitFlowCase.update" parameterClass="testunitFlowCaseDO">
    UPDATE tm_testunit_flow_case set GMT_MODIFIED=now()
    <dynamic>
      <isNotEmpty property="modifier" prepend=",">
        <![CDATA[  
        MODIFIER = #modifier#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="testunitFlowId" prepend=",">
        <![CDATA[  
        TESTUNIT_FLOW_ID = #testunitFlowId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="status" prepend=",">
        <![CDATA[  
        STATUS = #status#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="gmtStart" prepend=",">
        <![CDATA[  
        GMT_START = #gmtStart#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="gmtEnd" prepend=",">
        <![CDATA[  
        GMT_END = #gmtEnd#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="userId" prepend=",">
        <![CDATA[  
        USER_ID = #userId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="systemEnvId" prepend=",">
        <![CDATA[  
        SYSTEM_ENV_ID = #systemEnvId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="systemId" prepend=",">
        <![CDATA[  
        SYSTEM_ID = #systemId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="gmtNextRetry" prepend=",">
        <![CDATA[  
        GMT_NEXT_RETRY = #gmtNextRetry#  
        ]]>  
      </isNotEmpty>
    </dynamic>
     WHERE id = #id#  
  </update>

  <select id="testunitFlowCase.findById" parameterClass="Long" resultMap="testunitFlowCaseDO_resultMap">
     SELECT 
    <include refid="testunitFlowCase.column_List" />
    <![CDATA[  
     FROM tm_testunit_flow_case
     WHERE id = #id#
    ]]>  
  </select>
  
   
  <delete id="testunitFlowCase.deleteById" parameterClass="Long">
    <![CDATA[  
     DELETE FROM tm_testunit_flow_case 
      WHERE id = #id#
    ]]>  
  </delete>

  <select id="testunitFlowCase.findList" resultMap="testunitFlowCaseDO_resultMap" parameterClass="testunitFlowCaseDO">
     SELECT 
    <include refid="testunitFlowCase.column_List" />
     FROM tm_testunit_flow_case
	WHERE 1=1
    <include refid="testunitFlowCase.queryCondition" />
  </select>
  
  <sql id="testunitFlowCase.pageCondition">
	    <dynamic>
	      <isNotEmpty property="testunitFlowCaseStatusEnum" prepend="AND">
	        <![CDATA[  
	        	tfc.`status` = #testunitFlowCaseStatusEnum#
	        ]]>  
	      </isNotEmpty>
	      <isNotEmpty property="testunitFlowId" prepend="AND">
	        <![CDATA[  
	        	tfc.`testunit_flow_id` = #testunitFlowId# 
	        ]]>  
	      </isNotEmpty>
	      <isNotEmpty property="systemEnvId" prepend="AND">
	        <![CDATA[  
	        	tfc.`system_env_id` = #systemEnvId#
	        ]]>  
	      </isNotEmpty>
	      <isNotEmpty property="systemId" prepend="AND">
	        <![CDATA[  
	        	tfc.`system_id` = #systemId# 
	        ]]>  
	      </isNotEmpty>
	      <isNotEmpty property="testunitFlowId" prepend="AND">
	        <![CDATA[  
	        	tfc.`testunit_flow_id` = #testunitFlowId# 
	        ]]>  
	      </isNotEmpty>
	    </dynamic>
	  </sql>
  
  	<sql id="testunitFlowCase.page.sql">
	    <![CDATA[  
		select distinct 
		  tfc.`id`,
		  tfc.`status` status,
		  date_format(tfc.`gmt_start`, '%Y-%m-%d %T') gmtStart,
		  date_format(tfc.`gmt_end`, '%Y-%m-%d %T') gmtEnd,
		  tf.`name` testunitFlowName,
		  tf.`times` invokeTimes,
		  se.`config_name` systemEnvName,
		  s.`name` systemName 
		from
		  `tm_testunit_flow_case` tfc,
		  `tm_testunit_flow` tf,
		  `tm_system` s,
		  `tm_system_env` se 
		where tfc.`testunit_flow_id` = tf.`id` 
		  and tfc.`system_env_id` = se.`id` 
		  and tfc.`system_id` = s.`id` 
    	]]>
    	<include refid="testunitFlowCase.pageCondition" />
	</sql>
	
  <select id="testunitFlowCase.getCount" parameterClass="map" resultClass="java.lang.Integer">
    <![CDATA[  
     select count(1)
	   from (
	]]>
	   <include refid="testunitFlowCase.page.sql" />
	   
	<![CDATA[  
	   ) t2
    ]]>
  </select>	
  
  
  <select id="testunitFlowCase.pageList" parameterClass="map" resultClass="testunitFlowCaseVO">
	<include refid="testunitFlowCase.page.sql" />
	<include refid="paginationCondition" />
  </select>


  <select id="testunitFlowCase.queryTestunitFlowCase" parameterClass="Long" resultClass="testCaseVO">
    <![CDATA[  
		select 
		  tc.`id`,
		  tc.`status`,
		  date_format(tc.`gmt_start`, '%Y-%m-%d %T') gmtStart,
		  date_format(tc.`gmt_end`, '%Y-%m-%d %T') gmtEnd,
		  tf.`name` testunitFlowName,
		  tf.`remark`,
		  tu.`user_name` userName,
		  tu.`wangwang`,
		  tse.`config_name` configName,
		  ts.`name` systemName
		from
		  `tm_testunit_flow_case` tc,
		  `tm_testunit_flow` tf,
		  `tm_user` tu,
		  `tm_system` ts,
		  `tm_system_env` tse 
		where tc.`testunit_flow_id` = tf.`id` 
		  and tf.`user_id` = tu.`id` 
		  and tc.`system_id` = ts.`id` 
		  and tc.`system_env_id` = tse.`id` 
		  and tc.`id` = #id#
    ]]>  
  </select>
	
  
</sqlMap>
