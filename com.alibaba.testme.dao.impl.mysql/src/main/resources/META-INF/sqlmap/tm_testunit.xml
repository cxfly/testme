<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="testunit">
<typeAlias alias="testunitDO"    type="com.alibaba.testme.domain.dataobject.TestunitDO" />
<typeAlias alias="testunitVO"    type="com.alibaba.testme.domain.vo.TestunitVO" />
<typeAlias alias="testunitQuery"    type="com.alibaba.testme.domain.query.TestunitQuery" />
  <resultMap id="testunitDO_resultMap" class="testunitDO">
    <result property="id" column="ID" />
    <result property="gmtCreate" column="GMT_CREATE" />
    <result property="creator" column="CREATOR" />
    <result property="gmtModified" column="GMT_MODIFIED" />
    <result property="modifier" column="MODIFIER" />
    <result property="code" column="CODE" />
    <result property="name" column="NAME" />
    <result property="workSpaceId" column="WORK_SPACE_ID" />
    <result property="classQualifiedName" column="CLASS_QUALIFIED_NAME" />
	<result property="bundleFileName" column="BUNDLE_FILE_NAME" />
	<result property="symbolicName" column="SYMBOLIC_NAME" />
	<result property="bundleVersion" column="BUNDLE_VERSION" />
    <result property="tag" column="TAG" />
    <result property="userId" column="USER_ID" />
    <result property="remark" column="REMARK" />
  </resultMap>
 

  <sql id="testunit.column_List">
			ID
		   ,GMT_CREATE
		   ,CREATOR
		   ,GMT_MODIFIED
		   ,MODIFIER
		   ,CODE
		   ,NAME
		   ,WORK_SPACE_ID
		   ,CLASS_QUALIFIED_NAME
		   ,BUNDLE_FILE_NAME
		   ,SYMBOLIC_NAME
		   ,BUNDLE_VERSION
		   ,TAG
		   ,USER_ID
		   ,REMARK 
  </sql>
   
  <sql id="testunit.queryCondition">
    <dynamic>
      <isNotEmpty property="id" prepend="AND">
        <![CDATA[  
        ID = #id#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="creator" prepend="AND">
        <![CDATA[  
        CREATOR = #creator#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="modifier" prepend="AND">
        <![CDATA[  
        MODIFIER = #modifier#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="code" prepend="AND">
        <![CDATA[  
        CODE = #code#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="name" prepend="AND">
        <![CDATA[  
        NAME = #name#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="workSpaceId" prepend="AND">
        <![CDATA[  
        WORK_SPACE_ID = #workSpaceId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="classQualifiedName" prepend="AND">
        <![CDATA[  
        CLASS_QUALIFIED_NAME = #classQualifiedName#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="tag" prepend="AND">
        <![CDATA[  
        TAG = #tag#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="userId" prepend="AND">
        <![CDATA[  
        USER_ID = #userId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="remark" prepend="AND">
        <![CDATA[  
        REMARK = #remark#  
        ]]>  
      </isNotEmpty>
    </dynamic>
  </sql>
  
  <sql id="testunit.pageCondition">
    <dynamic>
      <isNotEmpty property="testunitName" prepend="AND">
        <![CDATA[  
        tu.name = #testunitName#  
        ]]>  
      </isNotEmpty>
	  <isNotEmpty property="testunitCode" prepend="AND">
        <![CDATA[  
        tu.code = #testunitCode#  
        ]]>  
      </isNotEmpty>
	  <isNotEmpty property="testunitTag" prepend="AND">
        <![CDATA[  
        tu.tag = #testunitTag#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="workSpaceId" prepend="AND">
        <![CDATA[  
        tu.work_space_id = #workSpaceId#  
        ]]>  
      </isNotEmpty>
	  <isNotEmpty property="systemId" prepend="AND">
        <![CDATA[  
        ws.system_id = #systemId#  
        ]]>  
      </isNotEmpty>
    </dynamic>
  </sql>

  
  <insert id="testunit.add" parameterClass="testunitDO">

    INSERT INTO tm_testunit(
   				GMT_CREATE
   			   ,CREATOR
   			   ,GMT_MODIFIED
   			   ,MODIFIER
   			   ,CODE
   			   ,NAME
   			   ,WORK_SPACE_ID
   			   ,CLASS_QUALIFIED_NAME
			   ,BUNDLE_FILE_NAME
			   ,SYMBOLIC_NAME
			   ,BUNDLE_VERSION
   			   ,TAG
   			   ,USER_ID
   			   ,REMARK) VALUES (
   				now()
   			   ,#creator#
   			   ,now()
   			   ,#modifier#
   			   ,#code#
   			   ,#name#
   			   ,#workSpaceId#
   			   ,#classQualifiedName#
			   ,#bundleFileName#
			   ,#symbolicName#
		       ,#bundleVersion#
   			   ,#tag#
   			   ,#userId#
   			   ,#remark#)
  
      <selectKey keyProperty="id" resultClass="Long">
      	SELECT LAST_INSERT_ID() AS value
      </selectKey>
  </insert>


  <update id="testunit.update" parameterClass="testunitDO">
    UPDATE tm_testunit set GMT_MODIFIED = now()
    <dynamic>
      <isNotEmpty property="modifier" prepend=",">
        <![CDATA[  
        MODIFIER = #modifier#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="code" prepend=",">
        <![CDATA[  
        CODE = #code#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="name" prepend=",">
        <![CDATA[  
        NAME = #name#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="workSpaceId" prepend=",">
        <![CDATA[  
        WORK_SPACE_ID = #workSpaceId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="classQualifiedName" prepend=",">
        <![CDATA[  
        CLASS_QUALIFIED_NAME = #classQualifiedName#  
        ]]>  
      </isNotEmpty>
	  <isNotEmpty property="bundleFileName" prepend=",">
        <![CDATA[  
        BUNDLE_FILE_NAME = #bundleFileName#  
        ]]>  
      </isNotEmpty>
	  <isNotEmpty property="symbolicName" prepend=",">
        <![CDATA[  
        SYMBOLIC_NAME = #symbolicName#  
        ]]>  
      </isNotEmpty>
	  <isNotEmpty property="bundleVersion" prepend=",">
        <![CDATA[  
        BUNDLE_VERSION = #bundleVersion#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="tag" prepend=",">
        <![CDATA[  
        TAG = #tag#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="userId" prepend=",">
        <![CDATA[  
        USER_ID = #userId#  
        ]]>  
      </isNotEmpty>
      <isNotEmpty property="remark" prepend=",">
        <![CDATA[  
        REMARK = #remark#  
        ]]>  
      </isNotEmpty>
    </dynamic>
     WHERE id = #id#  
  </update>

  <select id="testunit.findById" parameterClass="Long" resultMap="testunitDO_resultMap">
     SELECT 
    <include refid="testunit.column_List" />
    <![CDATA[  
     FROM tm_testunit
     WHERE id = #id#
    ]]>  
  </select>
  
   
  <delete id="testunit.deleteById" parameterClass="Long">
    <![CDATA[  
     DELETE FROM tm_testunit 
      WHERE id = #id#
    ]]>  
  </delete>

  <select id="testunit.findList" resultMap="testunitDO_resultMap" parameterClass="testunitDO">
     SELECT 
    <include refid="testunit.column_List" />
     FROM tm_testunit
	WHERE 1=1
    <include refid="testunit.queryCondition" />
  </select>
  
  <select id="testunit.getCount" parameterClass="map" resultClass="java.lang.Integer">
    <![CDATA[  
     select count(distinct tu.id)
	   from tm_testunit tu
	       ,tm_work_space ws
		   ,tm_system s
      where tu.work_space_id=ws.id
	    and ws.system_id=s.id
    ]]>
	<include refid="testunit.pageCondition" />
  </select>
  
  <select id="testunit.pageList" parameterClass="map" resultClass="testunitVO">
    <![CDATA[  
     select distinct tu.id              as testunitId
	       ,tu.name                     as testunitName
		   ,tu.code                     as testunitCode
		   ,tu.tag                      as testunitTag
		   ,tu.work_space_id            as workSpaceId
		   ,tu.user_id                  as userId
		   ,tu.class_qualified_name     as classQualifiedName
		   ,tu.bundle_file_name         as bundleFileName
		   ,tu.symbolic_name            as symbolicName
		   ,tu.bundle_version           as bundleVersion
		   ,ws.name                     as workSpaceName        
		   ,ws.system_id                as systemId
		   ,s.name                      as systemName
	   from tm_testunit tu
	       ,tm_work_space ws
		   ,tm_system s
      where tu.work_space_id=ws.id
	    and ws.system_id=s.id
    ]]>
	<include refid="testunit.pageCondition" />
	<include refid="paginationCondition" />
  </select>
  
  <select id="testunit.findByIdList" parameterClass="map" resultClass="testunitDO">
    <![CDATA[  
     select id    as id
	       ,name  as name
	   from tm_testunit 
      WHERE id in
    ]]> 
	<iterate property="idList" conjunction="," open="(" close=")">
			#idList[]#
    </iterate>
  </select>
  
  <select id="testunit.findByTestunitFlowId" parameterClass="Long" resultClass="testunitDO">
    <![CDATA[  
     select tfd.testunit_id    as id
	       ,tt.name            as name
	   from tm_testunit tt
	       ,tm_testunit_flow_detail tfd
      where tfd.testunit_id=tt.id
	    and tfd.testunit_flow_id=#testunitFlowId#
    ]]> 
  </select>
  
  <select id="testunit.findTestunitVOById" parameterClass="Long" resultClass="testunitVO">
    <![CDATA[  
     select distinct tu.id              as testunitId
	       ,tu.name                     as testunitName
		   ,tu.code                     as testunitCode
		   ,tu.tag                      as testunitTag
		   ,tu.work_space_id            as workSpaceId
		   ,tu.user_id                  as userId
		   ,tu.class_qualified_name     as classQualifiedName
		   ,tu.bundle_file_name         as bundleFileName
		   ,tu.symbolic_name            as symbolicName
		   ,tu.bundle_version           as bundleVersion
		   ,tu.remark                   as remark
		   ,ws.name                     as workSpaceName        
		   ,ws.system_id                as systemId
		   ,s.name                      as systemName
	   from tm_testunit tu
	       ,tm_work_space ws
		   ,tm_system s
      where tu.work_space_id=ws.id
	    and ws.system_id=s.id
		and tu.id=#testunitId#
    ]]>
  </select>
  
</sqlMap>
